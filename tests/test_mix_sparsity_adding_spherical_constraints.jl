include("./CombinationsOfSparsities.jl")
using .CombinationsOfSparsities

using DynamicPolynomials

@time begin
eps=1e-2
k=2 # relaxed order
r=4 #sparse order

@polyvar x1 x2 x3 # variables
x=[x1;x2;x3]

g=[1-x1^2-x2^2]
h=[x2*x3-1/2]



I=Array{Any}(undef, 2)
I[1]=[1;2]
I[2]=[2;3]

J=Array{Any}(undef, 2)
J[1]=[1]
J[2]=[]

W=Array{Any}(undef, 2)
W[1]=[]
W[2]=[1]

sol = CombinationsOfSparsities.mix_sparsity_adding_spherical_constraints(x,g,h,I,J,W,eps,k,r)
end


"""
Determine L0:
------------------------------------
The block-closure operation is stable at sparse order 1!
block_sigma0 = Array{Int64,1}[[1, 4, 6, 11, 13, 15, 22, 24, 26, 28], [2, 7, 9, 16, 18, 20], [3, 8, 10, 17, 19, 21], [5, 12, 14, 23, 25, 27]]
-----------------------------
block_sigma = Any[Array{UInt16,1}[[0x0001, 0x0004, 0x0006, 0x000b, 0x000d, 0x000f], [0x0002, 0x0007, 0x0009, 0x0010, 0x0012, 0x0014], [0x0003, 0x0008, 0x000a, 0x0011, 0x0013, 0x0015], [0x0005, 0x000c, 0x000e]]]
-----------------------------
block_psi = Any[]
=============================
The block-closure operation is stable at sparse order 1!
block_sigma0 = Array{Int64,1}[[1, 4, 5, 6, 11, 12, 13, 14, 15, 22, 23, 24, 25, 26, 27, 28], [2, 3, 7, 8, 9, 10, 16, 17, 18, 19, 20, 21]]
-----------------------------
block_sigma = Any[]
-----------------------------
block_psi = Any[Array{UInt16,1}[[0x0001, 0x0004, 0x0005, 0x0006, 0x000b, 0x000c, 0x000d, 0x000e, 0x000f], [0x0002, 0x0003, 0x0007, 0x0008, 0x0009, 0x000a, 0x0010, 0x0011, 0x0012, 0x0013, 0x0014, 0x0015]]]
=============================
Termination status = OPTIMAL
Optimal value = 1.062393848838014
====================================
Atom(I[1]):
====================================
Rank of moment matrix = 2
------------------------------------
atom 1 = Any[-1.3171050107960518e-18, 0.7021224139930897]
check lower bound  = 0
check inequality 1 = 0.5070241157685162
####################################
Solution = Any[-1.3171050107960518e-18, 0.7021224139930897]
####################################
------------------------------------
atom 2 = Any[-2.236072836453963e-17, -0.7021224139930897]
check lower bound  = 0
check inequality 1 = 0.5070241157685162
####################################
Solution = Any[-2.236072836453963e-17, -0.7021224139930897]
####################################
====================================
Atom(I[2]):
====================================
Rank of moment matrix = 4
------------------------------------
L0 = 1.062393848838014
====================================
Determine omega0[1]:
------------------------------------
The block-closure operation is stable at sparse order 1!
block_sigma0 = Array{Int64,1}[[1, 4, 6], [2], [3], [5]]
-----------------------------
block_sigma = Any[Array{UInt16,1}[[0x0001], [0x0002], [0x0003]], Array{UInt16,1}[[0x0001], [0x0002], [0x0003]]]
-----------------------------
block_psi = Any[]
=============================
The block-closure operation is stable at sparse order 1!
block_sigma0 = Array{Int64,1}[[1, 4, 5, 6], [2, 3]]
-----------------------------
block_sigma = Any[Array{UInt16,1}[[0x0001], [0x0002, 0x0003]]]
-----------------------------
block_psi = Any[Array{UInt16,1}[[0x0001], [0x0002, 0x0003]]]
=============================
Termination status = OPTIMAL
Optimal value = 0.3518364647207896
====================================
Atom(I[1]):
====================================
Rank of moment matrix = 2
------------------------------------
atom 1 = Any[-5.164259530428355e-17, 0.5931759884037678]
check lower bound  = 0
check inequality 1 = 0.648142246781213
check inequality 2 = 0.710536095619227
####################################
Solution = Any[-5.164259530428355e-17, 0.5931759884037678]
####################################
------------------------------------
atom 2 = Any[5.164259530428355e-17, -0.5931759884037678]
check lower bound  = 0
check inequality 1 = 0.648142246781213
check inequality 2 = 0.710536095619227
####################################
Solution = Any[5.164259530428355e-17, -0.5931759884037678]
####################################
====================================
Atom(I[2]):
====================================
Rank of moment matrix = 2
------------------------------------
atom 1 = Any[0.5931999321364043, 0.8429857823460027]
check lower bound  = 0
check inequality 1 = -0.00011733988612294688
check equality 1 = 5.910887960247635e-5
####################################
Solution = Any[0.5931999321364043, 0.8429857823460027]
####################################
------------------------------------
atom 2 = Any[-0.5931999321364043, -0.8429857823460026]
check lower bound  = 0
check inequality 1 = -0.00011733988612294688
check equality 1 = 5.910887960247635e-5
####################################
Solution = Any[-0.5931999321364043, -0.8429857823460026]
####################################
------------------------------------
omega0[1] = 0.3518364647207896
====================================
 29.888636 seconds (8.00 M allocations: 1.436 GiB, 1.79% gc time)
2-element Array{Any,1}:
 [-5.164259530428355e-17 5.164259530428355e-17; 0.5931759884037678 -0.5931759884037678]
 [0.5931999321364043 -0.5931999321364043; 0.8429857823460027 -0.8429857823460026]      
"""